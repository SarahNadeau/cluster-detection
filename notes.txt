
# Docker container of usher including matutils including clustertracker heuristic:

docker pull pathogengenomics/usher:latest

# It requires a two-column tsv as input alongside the protobuf containing names of samples and associated regions in the first and second columns respectively
# It requires a "protobuf" file as input before running the introduction estimation as follows:
matUtils introduce -i public-2021-04-20.all.masked.nextclade.pangolin.pb -s spanish_samples.txt -o spanish_introductions.txt

# Can export introductions for visualization in auspice:
matUtils extract -i public-2021-04-20.all.masked.nextclade.pangolin.pb -k "ESP/hCoV-19_Spain_CT-HUVH-76622_2021/2021|MW769758.1|21-01-19:50" -j spanish_introduction.json

# They already provide a snakemake workflow that takes in a fasta and outputs putative introductions:
cd usher/workflows
snakemake --use-conda --cores 4 --config FASTA="/path/to/fasta" RUNTYPE="introduce"

I couldn't get BSBP's assembly & annotation wf running on gizmo, got this error:
Error executing process > 'INFILE_HANDLING_UNIX (test)'

Caused by:
  Failed to pull singularity image
  command: singularity pull  --name ubuntu-jammy.img.pulling.1680886266107 docker://ubuntu:jammy > /dev/null
  status : 255
  message:
    [31mFATAL:   While making image from oci registry: failed to get checksum for docker://ubuntu:jammy: Error reading manifest jammy in docker.io/library/ubuntu: manifest unknown: OCI index found, but accept header does not support OCI indexes
SOLVED: use apptainer instead of singularity on cluster

DONE [hiv trace]: include context sequences or not in analysis? A: yes, good to see false positives for clustering
DONE [hiv trace]: include singletons in results

TODO [clustertracker]: abstract masking file
TODO [augur filter]: reference sequence in alignment & tree too many times?
TODO [treetime mugration]: unfair to not do repeated EM thing to do ASR?
TODO [treetime mugration]: only parsing results below inferred outbreak introduction nodes, should parse whole tree
TODO [hiv trace]: results json says "threshold: 0.0001" - is there a silent program minimum?
TODO (boston conf a analysis): missing lots of polytomy sequences with the outbreak I think, check context set methods