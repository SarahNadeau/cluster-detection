This script is to make figures showing the results.

```{r}
library(tidyverse)
library(ggplot2)
library(ggtree)

# Analysis-specific parameters
data_dir <- "nextflow/results/boston_confa_2023-04-21T13:14:43.502924-07:00"
outbreak_annotation <- "CONF_A"

# data_dir <- "nextflow/results/urmc_klebsiella_2023-04-21T10:26:45.975059-07:00"
# outbreak_annotation <- "URMC"

# Load collated results
results_per_sample <- read.delim(paste0(data_dir, "/collated_results_per_sample.txt"), sep = " ") %>%
    mutate(method = factor(method, levels = c("hivtrace", "clustertracker", "mugration")))
results_per_introduction <- read.delim(paste0(data_dir, "/collated_results_per_introduction.txt"), sep = " ") %>%
    mutate(method = factor(method, levels = c("hivtrace", "clustertracker", "mugration")))
```

Plot number of clusters by method
```{r}
clusters_by_method <- results_per_sample %>%
    filter(region == outbreak_annotation) %>%
    group_by(method) %>%
    summarise(n_samples = n(), n_clusters = length(unique(introduction_node)))

ggplot(data = clusters_by_method) +
    geom_col(aes(x = method, y = n_clusters)) + 
    theme_bw() + 
    labs(x = element_blank(), y = "Number of focal clusters")
ggsave(file = paste0(data_dir, "/n_clusters_by_method.png"), width = 3, height = 4)
```

Plot size of sampled outbreak
```{r}
outbreak_spread_by_method <- results_per_introduction %>%
    group_by(method) %>%
    summarize(
        n_introduction_nodes = length(unique(introduction_node)),
        `Context` = sum(tip_location != outbreak_annotation),
        `Focal` = sum(sum(tip_location == outbreak_annotation))) %>%
    pivot_longer(cols = c(`Context`, `Focal`), names_to = "Sample type")

ggplot(data = outbreak_spread_by_method) +
    geom_bar(aes(x = method, y = value, fill = `Sample type`), position = "stack", stat = "identity") +
    theme_bw() +
    labs(x = element_blank(), y = "Number of samples in focal clusters")
ggsave(file = paste0(data_dir, "/outbreak_size_by_method.png"), width = 4, height = 4)
```

Bits and bobs, leftovers
```{r}
# ggtree(mugration_treeio) + 
#     geom_label(aes(label = division)) +
#     geom_tiplab()
# ggsave("~/Downloads/tree.png", width = 20, height = 20)   
```